<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>AR Retail Try-On 2026</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    
    <style>
        body { margin: 0; background: #000; font-family: sans-serif; }
        #ui-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 10; pointer-events: none; display: flex; flex-direction: column;
        }
        .header { background: rgba(0,0,0,0.8); padding: 20px; color: #00ffcc; text-align: center; }
        .footer { margin-top: auto; padding: 30px; display: flex; justify-content: center; gap: 20px; pointer-events: auto; }
        button { 
            padding: 15px 25px; border-radius: 50px; border: 2px solid #00ffcc;
            background: rgba(0,255,204,0.1); color: #00ffcc; font-weight: bold; cursor: pointer;
        }
        button:hover { background: #00ffcc; color: #000; }
        video { display: none; } /* Hidden, used as source for A-Frame */
    </style>
</head>
<body>

    <div id="ui-overlay">
        <div class="header">VIRTUAL FITTING ROOM // 2026 RETAIL</div>
        <div class="footer">
            <button onclick="changeOutfit('#tshirt')">T-SHIRT</button>
            <button onclick="changeOutfit('#jacket')">JACKET</button>
            <button id="snapBtn">CAPTURE LOOK</button>
        </div>
    </div>

    <a-scene embedded vr-mode-ui="enabled: false">
        <a-assets>
            <video id="webcam" autoplay playsinline></video>
            <a-asset-item id="shirtModel" src="https://cdn.aframe.io/test-models/models/glTF-2.0/virtualcity/VC.gltf"></a-asset-item>
        </a-assets>

        <a-video src="#webcam" position="0 1.6 -3" width="6.4" height="4.8"></a-video>

        <a-entity id="outfit" position="0 1.6 -2" visible="false">
            <a-box id="torso" width="0.8" height="1" depth="0.2" color="#00ffcc" opacity="0.6">
                <a-text value="PREMIUM FIT" position="0 0.6 0.12" align="center" width="2"></a-text>
            </a-box>
            <a-cylinder position="-0.4 0.4 0" rotation="0 0 90" radius="0.05" height="0.4" color="#00ffcc"></a-cylinder>
            <a-cylinder position="0.4 0.4 0" rotation="0 0 -90" radius="0.05" height="0.4" color="#00ffcc"></a-cylinder>
        </a-entity>

        <a-camera position="0 1.6 0" look-controls-enabled="false"></a-camera>
    </a-scene>

    <script>
        const videoElement = document.getElementById('webcam');
        const outfit = document.getElementById('outfit');

        // 1. Setup MediaPipe Pose
        const pose = new Pose({
            locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/pose/${file}`
        });

        pose.setOptions({
            modelComplexity: 1,
            smoothLandmarks: true,
            minDetectionConfidence: 0.5,
            minTrackingConfidence: 0.5
        });

        // 2. Handle Pose Results
        pose.onResults((results) => {
            if (!results.poseLandmarks) {
                outfit.setAttribute('visible', 'false');
                return;
            }

            outfit.setAttribute('visible', 'true');

            // Landmark 11 & 12 are Shoulders
            const leftShoulder = results.poseLandmarks[11];
            const rightShoulder = results.poseLandmarks[12];
            const midHip = results.poseLandmarks[23]; // Landmark 23/24 are Hips

            // Calculate Position (Normalized 0-1 to A-Frame units)
            const centerX = (leftShoulder.x + rightShoulder.x) / 2;
            const centerY = (leftShoulder.y + midHip.y) / 2;
            
            // Map normalized MediaPipe (0 to 1) to A-Frame (-3 to 3 approx)
            const sceneX = (centerX - 0.5) * -6;
            const sceneY = (0.5 - centerY) * 4 + 1.6;

            outfit.setAttribute('position', `${sceneX} ${sceneY} -2`);

            // Calculate Scale based on shoulder width
            const shoulderWidth = Math.abs(leftShoulder.x - rightShoulder.x) * 5;
            outfit.setAttribute('scale', `${shoulderWidth} ${shoulderWidth} ${shoulderWidth}`);

            // Calculate Tilt (Rotation)
            const angle = Math.atan2(rightShoulder.y - leftShoulder.y, rightShoulder.x - leftShoulder.x);
            outfit.setAttribute('rotation', `0 0 ${angle * (180 / Math.PI)}`);
        });

        // 3. Start Camera
        const camera = new Camera(videoElement, {
            onFrame: async () => {
                await pose.send({image: videoElement});
            },
            width: 640,
            height: 480
        });
        camera.start();

        function changeOutfit(type) {
            const torso = document.getElementById('torso');
            if(type === '#jacket') {
                torso.setAttribute('color', '#333');
                torso.setAttribute('scale', '1.1 1.1 1.2');
            } else {
                torso.setAttribute('color', '#00ffcc');
                torso.setAttribute('scale', '1 1 1');
            }
        }
    </script>
</body>
</html>
